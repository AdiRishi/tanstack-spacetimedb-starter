# AGENTS.md

This file provides guidance to AI agents when working with code in this repository.

## Commands

```bash
pnpm dev                    # Full dev: SpacetimeDB server + publish module + generate bindings + Vite on :8080
pnpm dev:web                # Vite only (use when SpacetimeDB is already running)
pnpm build                  # Production build
pnpm test                   # Run tests (vitest run)
pnpm typecheck              # Type check (tsc --noEmit)
pnpm check                  # Format (prettier) + lint (eslint) with auto-fix
pnpm spacetime:start        # Start local SpacetimeDB server (separate terminal, before `pnpm dev`)
pnpm spacetime:generate     # Regenerate client bindings into src/module_bindings/
pnpm spacetime:publish      # Publish module to SpacetimeDB maincloud
```

## Architecture

**Monorepo** (pnpm workspaces): root web client + `spacetimedb/` workspace for the server module.

Full-stack real-time app using **TanStack Start** (React 19 + Vite 7 + Nitro) and **SpacetimeDB** as the database. No REST/GraphQL layer — the client connects directly to SpacetimeDB via WebSocket and data syncs automatically through TanStack Query.

### SpacetimeDB data flow

1. **Define schema** — Tables and reducers in `spacetimedb/src/index.ts`
2. **Generate bindings** — `spacetime generate` creates typed client code in `src/module_bindings/` (auto-generated, never edit)
3. **Connect** — `src/lib/spacetimedb-client.ts` creates `DbConnection` + bridges `SpacetimeDBQueryClient` to TanStack Query
4. **Provide** — `src/lib/app-provider.tsx` wraps the app with `SpacetimeDBProvider`
5. **Use** — `useSpacetimeDBQuery(tables.X)` for live reads, `useReducer(reducers.X)` for mutations

### Key directories

- `spacetimedb/src/` — Server module (tables, reducers, lifecycle hooks)
- `src/routes/` — File-based routes (TanStack Router, auto-generates `routeTree.gen.ts`)
- `src/module_bindings/` — Auto-generated client bindings (do not edit)
- `src/components/ui/` — shadcn/ui primitives (Base Vega style, Lucide icons)
- `src/lib/` — App providers, DB connection setup, utilities

### Adding UI components

```bash
pnpm shadcn add <component-name>
```

Components install to `src/components/ui/`. Theme tokens are in `src/global-styles/tailwind.css`.

## Conventions

- **Package manager**: pnpm (v10.x). Always use `pnpm` for install/scripts
- **TypeScript**: Strict mode. `@/*` maps to `./src/*`
- **No semicolons**, single quotes, trailing commas (Prettier config)
- **Import order**: Enforced by Prettier — third-party → `@/` aliases → relative (with blank-line separation)
- **Tailwind class sorting**: Enforced by `prettier-plugin-tailwindcss`
- **Formatting**: Follow `.editorconfig` for indentation and line endings
- **Comments**: Explain WHY, not WHAT — prefer clearer code over comments that restate logic
- **Docs research**: Prefer Context7 for up-to-date library documentation before implementing

### Auto-generated files (do not edit)

- `src/module_bindings/**` — Regenerated by `spacetime generate`
- `src/routeTree.gen.ts` — Regenerated by TanStack Router plugin
- `spacetimedb/dist/` — Compiled SpacetimeDB module output

### Environment

Only `VITE_*` vars are exposed to the client (Vite convention). Configured in `.env.local`:

- `VITE_SPACETIMEDB_HOST` — WebSocket host (default: `http://127.0.0.1:3000`)
- `VITE_SPACETIMEDB_DB_NAME` — Database name (default: `tanstack-start-spacetimedb`)

## Commit Convention

Use [Conventional Commits](https://www.conventionalcommits.org/) with **title only** (no description body):

```
<type>: <lowercase imperative summary>
```

**Types**: `feat`, `fix`, `refactor`, `chore`, `docs`, `style`, `init`

**Rules**: lowercase after the colon, imperative mood ("add X" not "added X"), no trailing period, no description body — title only.

## Skills

Invoke skills proactively — don't wait for the user to ask.

- **spacetimedb** — ALWAYS load before working with SpacetimeDB tables, reducers, client bindings, subscriptions, or React integration. This is the primary data layer — load it before writing any data-related code
- **frontend-design** — Use when building polished web UIs — pages, dashboards, or any component requiring distinctive design
- **agent-browser** — Use when automating browser interactions — navigating pages, filling forms, taking screenshots, or testing web apps
